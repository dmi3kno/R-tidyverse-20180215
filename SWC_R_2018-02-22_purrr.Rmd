---
title: "Functional programming in R"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(jsonlite)
library(tidyverse)
library(stringr)
library(glue)
library(httr)

json_txt <- read_lines("https://www.gapminder.org/wp-content/themes/gapminder/cronJobs/json.js")

sources <- fromJSON(paste0("[",substring(json_txt, 20),"]"), simplifyVector = FALSE)[[1]]

sheets_cat<- enframe(sources) %>% 
  mutate(value=map(value, enframe)) %>% 
  unnest %>% 
  mutate(value=unlist(value)) %>% 
  spread(key=name1, value=value)

gs_prefix <- "https://docs.google.com/spreadsheet/pub?key={key}"

key1 <- "pyj6tScZqmEfI4sLVvEQtHw"

re_url <- HEAD(glue(gs_prefix, key=key1))

stop_for_status(re_url)

map_chr(re_url, "url")

key2 <- "1JIGjdPybxc4kL-BUGbZa_zC7-WdR0QzycDUflwf-oHw"

pattern1 <- "https://docs.google.com/spreadsheets/d/{key}/gviz/tq?tqx=out:csv"
pattern2 <- "https://docs.google.com/spreadsheets/d/{key}/export?format=csv"

url_csv <- glue(pattern1, key=key2)

gs_read(gs_key(key2, lookup = FALSE), range =cell_rows(1:277), sheet=1)

https://docs.google.com/spreadsheets/d/1JIGjdPybxc4kL-BUGbZa_zC7-WdR0QzycDUflwf-oHw/gviz/tq?tqx=out:csv&sheet=Data

httr::GET("https://sheets.googleapis.com/v4/spreadsheets/1JIGjdPybxc4kL-BUGbZa_zC7-WdR0QzycDUflwf-oHw/values/Data!A1:D?majorDimension=COLUMNS&valueRenderOption=FORMULA")

httr::GET("https://www.googleapis.com/auth/spreadsheets")

sheets_cat %>% distinct(category)

library(glue)
download.file(glue("https://docs.google.com/spreadsheets/d/{key}/gviz/tq?tqx=out:csv", 
              key="pyj6tScZqmEfI4sLVvEQtHw"), )

https://docs.google.com/spreadsheet/pub?key=&output=csv
https://docs.google.com/spreadsheets/d/pyj6tScZqmEfbZyl0qjbiRQ/export?format=csv


#install.packages("googlesheets")
#install.packages("httpuv")
library(googlesheets)

googlesheets::gs_key("pyj6tScZqmEfI4sLVvEQtHw", lookup = FALSE)
gs_prefix <- "https://docs.google.com/spreadsheet/pub?key="

```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
